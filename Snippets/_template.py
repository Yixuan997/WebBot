# Name: ä»£ç ç‰‡æ®µåç§°
# Description: ä»£ç ç‰‡æ®µæè¿°
# Author: ä½œè€…å
# Version: 1.0.0

"""
ä»£ç ç‰‡æ®µå¼€å‘æ¨¡æ¿

æ­¤æ–‡ä»¶ä¸ºåˆ›å»ºæ–°ä»£ç ç‰‡æ®µæä¾›å®Œæ•´çš„APIæ–‡æ¡£å’Œç¤ºä¾‹ã€‚

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€å¯ç”¨å¯¹è±¡ã€‘

1. context - å·¥ä½œæµä¸Šä¸‹æ–‡å¯¹è±¡
   å±æ€§:
   - context.event           # BaseEvent å¯¹è±¡ï¼ŒåŒ…å«å®Œæ•´çš„æ¶ˆæ¯äº‹ä»¶ä¿¡æ¯
   - context.variables       # dictï¼Œå­˜å‚¨æ‰€æœ‰å·¥ä½œæµå˜é‡
   
   æ–¹æ³•:
   - context.get_variable(key, default=None)      # è·å–å˜é‡
   - context.set_variable(key, value)             # è®¾ç½®å˜é‡
   - context.set_response(message)                # è®¾ç½®å“åº”æ¶ˆæ¯
   - context.get_response()                       # è·å–å“åº”æ¶ˆæ¯
   - context.render_template(template_str)        # Jinja2æ¨¡æ¿æ¸²æŸ“

2. context.event - äº‹ä»¶å¯¹è±¡
   æ–¹æ³•:
   - context.event.get_plaintext()                # -> str: è·å–çº¯æ–‡æœ¬æ¶ˆæ¯
   - context.event.get_message()                  # -> BaseMessage: è·å–å®Œæ•´æ¶ˆæ¯å¯¹è±¡
   - context.event.get_user_id()                  # -> str: è·å–å‘é€è€…ID
   - context.event.get_session_id()               # -> str: è·å–ä¼šè¯ID
   - context.event.is_tome()                      # -> bool: æ¶ˆæ¯æ˜¯å¦@æœºå™¨äºº
   - context.event.get_type()                     # -> str: äº‹ä»¶ç±»å‹

3. message_api - æ¶ˆæ¯å‘é€APIï¼ˆå­˜å‚¨åœ¨ context.variables['message_api']ï¼‰
   æ–¹æ³•:
   - message_api.send_message(content)            # å‘é€æ¶ˆæ¯ï¼ˆå­—ç¬¦ä¸²æˆ–BaseMessageï¼‰
   - message_api.reply(content)                   # send_messageçš„åˆ«å

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€å¼€å§‹èŠ‚ç‚¹æå–çš„å˜é‡ã€‘

å¯é€šè¿‡ context.get_variable() è·å–ï¼š

- message              # str: çº¯æ–‡æœ¬æ¶ˆæ¯å†…å®¹
- message_full         # BaseMessage: å®Œæ•´æ¶ˆæ¯å¯¹è±¡
- message_type         # str: æ¶ˆæ¯ç±»å‹ï¼ˆtext/image/voiceï¼‰
- has_image            # bool: æ˜¯å¦åŒ…å«å›¾ç‰‡
- has_at               # bool: æ˜¯å¦åŒ…å«@
- sender.user_id       # str: å‘é€è€…ç”¨æˆ·ID
- sender.nickname      # str: å‘é€è€…æ˜µç§°
- sender               # object: å®Œæ•´senderå¯¹è±¡
- group_id             # str: ç¾¤èŠIDï¼ˆä»…ç¾¤èŠï¼‰
- is_group             # bool: æ˜¯å¦ç¾¤èŠ
- protocol             # str: åè®®ç±»å‹ï¼ˆqq/onebotï¼‰
- event                # BaseEvent: å®Œæ•´äº‹ä»¶å¯¹è±¡

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€å¿…é¡»è®¾ç½®ã€‘

- result               # ä»»æ„ç±»å‹: ä»£ç ç‰‡æ®µçš„æ‰§è¡Œç»“æœï¼Œå¿…é¡»è®¾ç½®ï¼

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€æ³¨æ„äº‹é¡¹ã€‘

1. ä»¥ä¸‹åˆ’çº¿å¼€å¤´çš„æ–‡ä»¶ï¼ˆå¦‚ _template.pyï¼‰ä¸ä¼šè¢«åŠ è½½åˆ°ä»£ç ç‰‡æ®µåˆ—è¡¨
2. å¯ä»¥ import ä»»ä½• Python æ¨¡å—
3. å¼‚å¸¸ä¼šè¢«è‡ªåŠ¨æ•è·å¹¶è®°å½•åˆ°æ—¥å¿—
4. ä»£ç ç‰‡æ®µæ‰§è¡Œåœ¨çº¿ç¨‹æ± ä¸­ï¼Œé¿å…é•¿æ—¶é—´é˜»å¡æ“ä½œ
5. æ›´å¤šç¤ºä¾‹è¯·æŸ¥çœ‹ Snippets/echo_message.py

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
"""

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ã€ç¤ºä¾‹ 1ã€‘ç®€å•æ–‡æœ¬å›å¤
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# 1. è·å–æ¶ˆæ¯å’Œå‘é€è€…ä¿¡æ¯
message = context.get_variable('message', '')
sender_name = context.get_variable('sender.nickname', 'ç”¨æˆ·')

# 2. æ„é€ å›å¤å†…å®¹
reply = f"ä½ å¥½ {sender_name}ï¼Œä½ è¯´äº†ï¼š{message}"

# 3. å‘é€å›å¤
message_api = context.get_variable('message_api')
if message_api:
    message_api.send_message(reply)

# 4. è®¾ç½®è¿”å›å€¼ï¼ˆå¿…é¡»ï¼‰
result = "æ‰§è¡ŒæˆåŠŸ"

# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ã€ç¤ºä¾‹ 2ã€‘æ¡ä»¶åˆ¤æ–­ - ç‰¹å®šç”¨æˆ·å›å¤
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# user_id = context.get_variable('sender.user_id', '')
# message_api = context.get_variable('message_api')
# 
# # åˆ¤æ–­æ˜¯å¦ä¸ºVIPç”¨æˆ·
# VIP_USERS = ['123456', '789012']  # VIPç”¨æˆ·åˆ—è¡¨
# 
# if user_id in VIP_USERS:
#     message_api.send_message("ğŸ‰ ä½ æ˜¯VIPç”¨æˆ·ï¼Œäº«å—ç‰¹æƒæœåŠ¡ï¼")
#     result = f"VIPç”¨æˆ· {user_id} å·²å›å¤"
# else:
#     result = f"éVIPç”¨æˆ· {user_id}ï¼Œè·³è¿‡å¤„ç†"


# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ã€ç¤ºä¾‹ 3ã€‘ä½¿ç”¨ context.event ç›´æ¥è®¿é—®äº‹ä»¶
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# # ç›´æ¥ä» context.event è·å–ä¿¡æ¯
# message_text = context.event.get_plaintext()
# user_id = context.event.get_user_id()
# is_at_me = context.event.is_tome()
# 
# message_api = context.variables['message_api']
# 
# if is_at_me:
#     message_api.send_message(f"ä½ @äº†æˆ‘ï¼Œæ¶ˆæ¯å†…å®¹æ˜¯ï¼š{message_text}")
#     result = "å·²å›å¤@æ¶ˆæ¯"
# else:
#     result = "æœª@æœºå™¨äººï¼Œè·³è¿‡"


# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ã€ç¤ºä¾‹ 4ã€‘ä½¿ç”¨ MessageBuilder æ„é€ å¤æ‚æ¶ˆæ¯
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# from Core.message.builder import MessageBuilder
# 
# message_api = context.variables['message_api']
# sender_name = context.get_variable('sender.nickname', 'ç”¨æˆ·')
# 
# # æ„é€ æ–‡æœ¬ + å›¾ç‰‡ç»„åˆæ¶ˆæ¯
# reply = MessageBuilder.text(f"ä½ å¥½ {sender_name}ï¼")
# # reply = reply + MessageBuilder.image("path/to/image.jpg")  # æ·»åŠ å›¾ç‰‡
# 
# message_api.send_message(reply)
# result = "å¤æ‚æ¶ˆæ¯å·²å‘é€"


# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ã€ç¤ºä¾‹ 5ã€‘è®¾ç½®å˜é‡ä¾›åç»­èŠ‚ç‚¹ä½¿ç”¨
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# message = context.get_variable('message', '')
# 
# # å¤„ç†æ•°æ®
# processed_data = message.upper()  # è½¬æˆå¤§å†™
# word_count = len(message.split())  # è®¡ç®—å•è¯æ•°
# 
# # ä¿å­˜åˆ°ä¸Šä¸‹æ–‡ï¼Œä¾›åç»­èŠ‚ç‚¹ä½¿ç”¨
# context.set_variable('processed_message', processed_data)
# context.set_variable('word_count', word_count)
# 
# result = f"å¤„ç†å®Œæˆ: {word_count} ä¸ªå•è¯"


# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ã€ç¤ºä¾‹ 6ã€‘é”™è¯¯å¤„ç†
# â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# try:
#     # ä½ çš„ä»£ç é€»è¾‘
#     message = context.get_variable('message')
#     if not message:
#         raise ValueError("æ¶ˆæ¯ä¸ºç©º")
#     
#     # å¤„ç†æ¶ˆæ¯
#     message_api = context.variables['message_api']
#     message_api.send_message(f"å¤„ç†æˆåŠŸï¼š{message}")
#     
#     result = "æ‰§è¡ŒæˆåŠŸ"
#     
# except Exception as e:
#     # é”™è¯¯ä¼šè‡ªåŠ¨è®°å½•åˆ°æ—¥å¿—ï¼Œä½†ä½ ä¹Ÿå¯ä»¥è‡ªå·±å¤„ç†
#     result = f"æ‰§è¡Œå¤±è´¥: {str(e)}"
