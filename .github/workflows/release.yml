name: ðŸš€ è‡ªåŠ¨å‘å¸ƒRelease

on:
  push:
    tags:
      - 'v*'  # å½“æŽ¨é€vå¼€å¤´çš„æ ‡ç­¾æ—¶è§¦å‘

permissions:
  contents: write  # éœ€è¦å†™æƒé™æ¥åˆ›å»ºRelease

jobs:
  release:
    name: åˆ›å»ºRelease
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: ðŸ“‹ æå–ç‰ˆæœ¬ä¿¡æ¯
      id: version
      run: |
        VERSION=${GITHUB_REF#refs/tags/}
        echo "version=$VERSION" >> $GITHUB_OUTPUT
        echo "version_number=${VERSION#v}" >> $GITHUB_OUTPUT

    - name: ðŸ“¦ åˆ›å»ºå‘å¸ƒåŒ…
      run: |
        echo "åˆ›å»ºå‘å¸ƒåŒ…..."

        # åŽ‹ç¼©æ‰€æœ‰å†…å®¹ï¼ŒæŽ’é™¤.gitå’Œ.githubç›®å½•
        zip -r "WebBot-${{ steps.version.outputs.version }}.zip" . -x ".git/*" ".github/*"

        # æ˜¾ç¤ºåŽ‹ç¼©åŒ…ä¿¡æ¯
        ls -lh "WebBot-${{ steps.version.outputs.version }}.zip"

        echo "å‘å¸ƒåŒ…åˆ›å»ºå®Œæˆï¼"

    - name: ðŸ“ ç”ŸæˆReleaseè¯´æ˜Ž
      id: release_notes
      run: |
        RELEASE_TIME=$(date '+%Y-%m-%d %H:%M:%S UTC')
        cat > release_notes.md << EOF
        ## ðŸš€ ç‰ˆæœ¬ ${{ steps.version.outputs.version }}
        
        ### ðŸ“ æ›´æ–°å†…å®¹
        - ðŸ”„ è‡ªåŠ¨å‘å¸ƒç‰ˆæœ¬ ${{ steps.version.outputs.version }}
        - âœ¨ åŒ…å«æœ€æ–°çš„åŠŸèƒ½å’Œä¿®å¤
        
        ### ðŸ“¦ åŒ…å«å†…å®¹
        - âœ… **æ ¸å¿ƒç³»ç»Ÿ** - å®Œæ•´çš„QQæœºå™¨äººç®¡ç†ç³»ç»Ÿ
        - âœ… **Webç®¡ç†ç•Œé¢** - åŸºäºŽFlask + Tablerçš„çŽ°ä»£åŒ–ç•Œé¢
        - âœ… **QQæœºå™¨äººé€‚é…å™¨** - æ”¯æŒQQå®˜æ–¹æœºå™¨äººAPI
        - âœ… **æ’ä»¶ç³»ç»Ÿ** - çµæ´»çš„æ’ä»¶æž¶æž„ï¼Œæ”¯æŒçƒ­æ’æ‹”
        - âœ… **ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ** - å®Œæ•´çš„ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æƒé™ç®¡ç†
        - âœ… **æ•°æ®åº“æ”¯æŒ** - SQLite + RedisåŒé‡å­˜å‚¨
        
        ### ðŸ”Œ å†…ç½®æ’ä»¶
        | æ’ä»¶åç§° | åŠŸèƒ½æè¿° | çŠ¶æ€ |
        |---------|---------|------|
        | **demo** | æ¼”ç¤ºæ’ä»¶ï¼Œå±•ç¤ºæ’ä»¶å¼€å‘ç¤ºä¾‹ | âœ… å¯ç”¨ |
        | **echo** | å›žå£°æ’ä»¶ï¼Œæµ‹è¯•æœºå™¨äººå“åº” | âœ… å¯ç”¨ |
        | **help** | å¸®åŠ©æ’ä»¶ï¼Œæ˜¾ç¤ºå¯ç”¨å‘½ä»¤ | âœ… å¯ç”¨ |
        | **Yapi** | YAPIæ’ä»¶ï¼Œæ¸¸æˆæ•°æ®æŸ¥è¯¢ | âœ… å¯ç”¨ |
        | **RussianRoulette** | ä¿„ç½—æ–¯è½®ç›˜æ¸¸æˆæ’ä»¶ | âœ… å¯ç”¨ |
        
        ### ðŸ› ï¸ æŠ€æœ¯æ ˆ
        - **åŽç«¯**: Python 3.10+ / Flask
        - **å‰ç«¯**: Tabler UI Framework
        - **æ•°æ®åº“**: SQLite + Redis
        - **æœºå™¨äºº**: QQå®˜æ–¹æœºå™¨äººAPI
        - **éƒ¨ç½²**: Gunicorn + Nginx
        
        ### ðŸ” å®‰å…¨ç‰¹æ€§
        - âœ… **æƒé™ç®¡ç†** - å¤šçº§ç”¨æˆ·æƒé™ç³»ç»Ÿ
        - âœ… **æ•°æ®åŠ å¯†** - æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
        - âœ… **APIéªŒè¯** - QQæœºå™¨äººç­¾åéªŒè¯
        - âœ… **ä¼šè¯ç®¡ç†** - å®‰å…¨çš„ç”¨æˆ·ä¼šè¯
        - âœ… **è¾“å…¥éªŒè¯** - ä¸¥æ ¼çš„æ•°æ®éªŒè¯æœºåˆ¶
        
        ### âš ï¸ æ³¨æ„äº‹é¡¹
        - éœ€è¦Python 3.10æˆ–æ›´é«˜ç‰ˆæœ¬
        - å»ºè®®ä½¿ç”¨è™šæ‹ŸçŽ¯å¢ƒå®‰è£…ä¾èµ–
        - ç”Ÿäº§çŽ¯å¢ƒè¯·ä½¿ç”¨HTTPS
        - å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶
        
        ### ðŸ†• ç‰ˆæœ¬ç‰¹è‰²
        - ðŸŽ¨ **çŽ°ä»£åŒ–ç•Œé¢** - åŸºäºŽTablerçš„ç¾Žè§‚UI
        - ðŸ”Œ **æ’ä»¶çƒ­æ’æ‹”** - æ— éœ€é‡å¯å³å¯å¯ç”¨/ç¦ç”¨æ’ä»¶
        - ðŸ“Š **å®žæ—¶ç›‘æŽ§** - ç³»ç»ŸçŠ¶æ€å’Œæœºå™¨äººè¿è¡Œç›‘æŽ§
        - ðŸ›¡ï¸ **å®‰å…¨åŠ å›º** - å¤šé‡å®‰å…¨é˜²æŠ¤æœºåˆ¶
        - ðŸš€ **é«˜æ€§èƒ½** - ä¼˜åŒ–çš„ä»£ç ç»“æž„å’Œæ‰§è¡Œæ•ˆçŽ‡
        
        ---
        
        ### ðŸ’ æ„Ÿè°¢ä½¿ç”¨
        
        å¦‚æžœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªâ­ï¸æ”¯æŒä¸€ä¸‹ï¼
        
        **å‘å¸ƒæ—¶é—´**: $RELEASE_TIME
        **æž„å»ºç‰ˆæœ¬**: ${{ github.sha }}
        EOF
        
    - name: ðŸŽ åˆ›å»ºReleaseå¹¶ä¸Šä¼ æ–‡ä»¶
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        echo "åˆ›å»ºReleaseå¹¶ä¸Šä¼ åŽ‹ç¼©åŒ…..."

        gh release create ${{ steps.version.outputs.version }} \
          --title "ðŸš€ Release ${{ steps.version.outputs.version }}" \
          --notes-file release_notes.md \
          --latest \
          "WebBot-${{ steps.version.outputs.version }}.zip"

        echo "Releaseåˆ›å»ºå®Œæˆï¼ŒåŽ‹ç¼©åŒ…å·²ä¸Šä¼ ï¼"
        
    - name: ðŸ“¢ å‘å¸ƒæˆåŠŸé€šçŸ¥
      run: |
        echo "ðŸŽ‰ Release ${{ steps.version.outputs.version }} åˆ›å»ºæˆåŠŸï¼"
        echo "ðŸ“¦ è®¿é—®åœ°å€: https://github.com/Yixuan997/WebBot/releases/tag/${{ steps.version.outputs.version }}"
        echo "ðŸ’¾ å·²ä¸Šä¼ ç¼–è¯‘åŽçš„é¡¹ç›®åŒ…: WebBot-${{ steps.version.outputs.version }}.zip"
        echo "ðŸ”„ çŽ°åœ¨æ”¯æŒä¸€é”®çƒ­æ›´æ–°åŠŸèƒ½ï¼"
